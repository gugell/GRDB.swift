import XCTest
#if GRDBCIPHER
    import GRDBCipher
#elseif GRDBCUSTOMSQLITE
    import GRDBCustomSQLite
#else
    import GRDB
#endif

class DatabaseValueConvertibleEncodableTests: GRDBTestCase {
    func testDatabaseValueConvertibleImplementationDerivedFromEncodable() {
        struct Value : Encodable, DatabaseValueConvertible {
            let string: String
            
            func encode(to encoder: Encoder) throws {
                var container = encoder.singleValueContainer()
                try container.encode(string)
            }
            
            static func fromDatabaseValue(_ databaseValue: DatabaseValue) -> Value? {
                preconditionFailure("unused")
            }
            
            // Infered, tested
            // var databaseValue: DatabaseValue { ... }
        }
        
        let dbValue = Value(string: "foo").databaseValue
        XCTAssertEqual(dbValue.storage.value as! String, "foo")
    }
    
    // This test crashes the compiler
    func testEncodableRawRepresentable() {
        // Assertion failed: ((HadError || !M.is<SourceFile*>() || M.get<SourceFile*>()->ASTStage < SourceFile::TypeChecked) && "OverloadedDeclRef" "in wrong phase"), function walkToExprPre, file /Users/buildnode/jenkins/workspace/oss-swift-package-osx/swift/include/swift/AST/ExprNodes.def, line 77.
        // 0  swift                    0x000000010dec2a08 llvm::sys::PrintStackTrace(llvm::raw_ostream&) + 40
        // 1  swift                    0x000000010dec19d6 llvm::sys::RunSignalHandlers() + 86
        // 2  swift                    0x000000010dec2fc9 SignalHandler(int) + 361
        // 3  libsystem_platform.dylib 0x00007fffd5a8bb3a _sigtramp + 26
        // 4  libsystem_platform.dylib 0x000000040bd05a43 _sigtramp + 908566307
        // 5  libsystem_c.dylib        0x00007fffd5910420 abort + 129
        // 6  libsystem_c.dylib        0x00007fffd58d7893 basename_r + 0
        // 7  swift                    0x000000010bc39b1b (anonymous namespace)::Verifier::walkToExprPre(swift::Expr*) + 491
        // 8  swift                    0x000000010bc4e724 (anonymous namespace)::Traversal::visitApplyExpr(swift::ApplyExpr*) + 36
        // 9  swift                    0x000000010bc4eaf8 swift::ASTVisitor<(anonymous namespace)::Traversal, swift::Expr*, swift::Stmt*, bool, swift::Pattern*, bool, void>::visit(swift::Stmt*) + 216
        // 10 swift                    0x000000010bc51120 (anonymous namespace)::Traversal::visitAbstractFunctionDecl(swift::AbstractFunctionDecl*) + 704
        // 11 swift                    0x000000010bc4a417 (anonymous namespace)::Traversal::doIt(swift::Decl*) + 327
        // 12 swift                    0x000000010bc50e14 (anonymous namespace)::Traversal::visitNominalTypeDecl(swift::NominalTypeDecl*) + 452
        // 13 swift                    0x000000010bc4a40a (anonymous namespace)::Traversal::doIt(swift::Decl*) + 314
        // 14 swift                    0x000000010bc4a2bb swift::Decl::walk(swift::ASTWalker&) + 27
        // 15 swift                    0x000000010bcd541a swift::SourceFile::walk(swift::ASTWalker&) + 170
        // 16 swift                    0x000000010bc3937b swift::verify(swift::SourceFile&) + 59
        // 17 swift                    0x000000010bbbcbff swift::performTypeChecking(swift::SourceFile&, swift::TopLevelContext&, swift::OptionSet<swift::TypeCheckingFlags, unsigned int>, unsigned int, unsigned int) + 2079
        // 18 swift                    0x000000010b710ff9 swift::CompilerInstance::performSema() + 3881
        // 19 swift                    0x000000010aca8e2b performCompile(swift::CompilerInstance&, swift::CompilerInvocation&, llvm::ArrayRef<char const*>, int&, swift::FrontendObserver*, swift::UnifiedStatsReporter*) + 2427
        // 20 swift                    0x000000010aca73da swift::performFrontend(llvm::ArrayRef<char const*>, char const*, void*, swift::FrontendObserver*) + 2650
        // 21 swift                    0x000000010ac63ed0 main + 3312
        // 22 libdyld.dylib            0x00007fffd587c235 start + 1
        // Stack dump:
        // 0.	Program arguments: /Library/Developer/Toolchains/swift-DEVELOPMENT-SNAPSHOT-2017-05-25-a.xctoolchain/usr/bin/swift -frontend -c /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RecordPersistenceConflictPolicy.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/Record+QueryInterfaceRequestTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RowAdapterTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseCursorTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/TableMappingDeleteByKeyTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RecordPrimaryKeyNoneTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseQueueConcurrencyTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RecordMinimalPrimaryKeyRowIDTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RowFromDictionaryTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/SchedulingWatchdogTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseCoderTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseCollationTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/StatementColumnConvertibleFetchTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/QueryInterfaceExpressionsTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/SelectStatementTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FTS5TableBuilderTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/UpdateStatementTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseMigratorTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FoundationNSNullTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/IteratorCursorTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabasePoolCollationTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RecordPrimaryKeySingleTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/StatementColumnConvertibleTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseWriterTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabasePoolFunctionTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RowCopiedFromStatementTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/QueryInterfaceExtensibilityTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseSavepointTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/MutablePersistablePersistenceConflictPolicyTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseQueueSchemaCacheTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RowFromDictionaryLiteralTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/AnyCursorTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/VirtualTableModuleTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/TableDefinitionTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RecordPrimaryKeyMultipleTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RowFromStatementTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/StatementArgumentsTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseValueConvertibleEscapingTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabasePoolBackupTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FTS3RecordTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FetchedRecordsControllerTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RecordInitializersTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/MutablePersistableTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FoundationNSDataTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FTS5CustomTokenizerTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RowConvertible+QueryInterfaceRequestTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabasePoolReadOnlyTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FoundationNSURLTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FoundationURLTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/ResultCodeTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DataMemoryTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/EncryptionTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RequestTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RowConvertibleDecodableTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseQueueBackupTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RecordCopyTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FTS5PatternTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/PersistableTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseValueConversionTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FoundationNSNumberTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RawRepresentable+DatabaseValueConvertibleTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabasePoolConcurrencyTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/TransactionObserverTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FoundationDateTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/Row+FoundationTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/TableMappingTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FlattenCursorTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/IndexInfoTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FilterCursorTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FTS5WrapperTokenizerTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RecordSubClassTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseValueTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseQueueReadOnlyTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseReaderTests.swift -primary-file /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseValueConvertibleEncodableTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FoundationNSUUIDTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FTS3PatternTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FTS3TokenizerTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FTS5TokenizerTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RowConvertibleTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FTS4RecordTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/EnumeratedCursorTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/SQLExpressionLiteralTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseValueConvertibleFetchTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RecordPrimaryKeyRowIDTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RecordPrimaryKeyHiddenRowIDTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RecordEditedTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabasePoolSchemaCacheTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FTS4TableBuilderTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RecordPrimaryKeySingleWithReplaceConflictResolutionTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseValueConvertibleSubclassTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FoundationUUIDTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseErrorTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FoundationDateComponentsTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FoundationDataTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseQueueReleaseMemoryTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FoundationNSDecimalNumberTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/NumericOverflowTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabasePoolReleaseMemoryTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RowTestCase.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseLogErrorTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RecordMinimalPrimaryKeySingleTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FTS3TableBuilderTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseTimestampTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/SQLRequestTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseValueConvertibleDecodableTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/StatementArguments+FoundationTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RowFetchTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/CursorTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FoundationNSStringTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/TableMapping+QueryInterfaceRequestTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FoundationNSDateTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/QueryInterfaceRequestTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/TransactionObserverSavepointsTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/MutablePersistableEncodableTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseFunctionTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseQueueInMemoryTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RecordWithColumnNameManglingTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/RecordUniqueIndexTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/CGFloatTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/StatementSelectionInfoTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/FTS5RecordTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseQueueTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/MapCursorTests.swift /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/GRDBTestCase.swift -target x86_64-apple-ios8.0 -enable-objc-interop -sdk /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator10.3.sdk -I /Users/groue/Library/Developer/Xcode/DerivedData/GRDB-ewuprfwphsnwtmeyrxipxvnnkjxx/Build/Intermediates/CodeCoverage/Products/Debug-iphonesimulator -F /Users/groue/Library/Developer/Xcode/DerivedData/GRDB-ewuprfwphsnwtmeyrxipxvnnkjxx/Build/Intermediates/CodeCoverage/Products/Debug-iphonesimulator -F /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/Library/Frameworks -enable-testing -g -module-cache-path /Users/groue/Library/Developer/Xcode/DerivedData/ModuleCache -profile-generate -profile-coverage-mapping -D SQLITE_MODULE -serialize-debugging-options -serialize-debugging-options -Xcc -I/Users/groue/Library/Developer/Xcode/DerivedData/GRDB-ewuprfwphsnwtmeyrxipxvnnkjxx/Build/Intermediates/CodeCoverage/Intermediates/GRDB.build/Debug-iphonesimulator/GRDBiOSTests.build/swift-overrides.hmap -Xcc -iquote -Xcc /Users/groue/Library/Developer/Xcode/DerivedData/GRDB-ewuprfwphsnwtmeyrxipxvnnkjxx/Build/Intermediates/CodeCoverage/Intermediates/GRDB.build/Debug-iphonesimulator/GRDBiOSTests.build/GRDBiOSTests-generated-files.hmap -Xcc -I/Users/groue/Library/Developer/Xcode/DerivedData/GRDB-ewuprfwphsnwtmeyrxipxvnnkjxx/Build/Intermediates/CodeCoverage/Intermediates/GRDB.build/Debug-iphonesimulator/GRDBiOSTests.build/GRDBiOSTests-own-target-headers.hmap -Xcc -I/Users/groue/Library/Developer/Xcode/DerivedData/GRDB-ewuprfwphsnwtmeyrxipxvnnkjxx/Build/Intermediates/CodeCoverage/Intermediates/GRDB.build/Debug-iphonesimulator/GRDBiOSTests.build/GRDBiOSTests-all-non-framework-target-headers.hmap -Xcc -ivfsoverlay -Xcc /Users/groue/Library/Developer/Xcode/DerivedData/GRDB-ewuprfwphsnwtmeyrxipxvnnkjxx/Build/Intermediates/CodeCoverage/Intermediates/GRDB.build/all-product-headers.yaml -Xcc -iquote -Xcc /Users/groue/Library/Developer/Xcode/DerivedData/GRDB-ewuprfwphsnwtmeyrxipxvnnkjxx/Build/Intermediates/CodeCoverage/Intermediates/GRDB.build/Debug-iphonesimulator/GRDBiOSTests.build/GRDBiOSTests-project-headers.hmap -Xcc -I/Users/groue/Library/Developer/Xcode/DerivedData/GRDB-ewuprfwphsnwtmeyrxipxvnnkjxx/Build/Intermediates/CodeCoverage/Products/Debug-iphonesimulator/include -Xcc -I/Users/groue/Library/Developer/Xcode/DerivedData/GRDB-ewuprfwphsnwtmeyrxipxvnnkjxx/Build/Intermediates/CodeCoverage/Intermediates/GRDB.build/Debug-iphonesimulator/GRDBiOSTests.build/DerivedSources/x86_64 -Xcc -I/Users/groue/Library/Developer/Xcode/DerivedData/GRDB-ewuprfwphsnwtmeyrxipxvnnkjxx/Build/Intermediates/CodeCoverage/Intermediates/GRDB.build/Debug-iphonesimulator/GRDBiOSTests.build/DerivedSources -Xcc -DDEBUG=1 -Xcc -working-directory/Users/groue/Documents/git/groue/GRDB.swift -emit-module-doc-path /Users/groue/Library/Developer/Xcode/DerivedData/GRDB-ewuprfwphsnwtmeyrxipxvnnkjxx/Build/Intermediates/CodeCoverage/Intermediates/GRDB.build/Debug-iphonesimulator/GRDBiOSTests.build/Objects-normal/x86_64/DatabaseValueConvertibleEncodableTests~partial.swiftdoc -serialize-diagnostics-path /Users/groue/Library/Developer/Xcode/DerivedData/GRDB-ewuprfwphsnwtmeyrxipxvnnkjxx/Build/Intermediates/CodeCoverage/Intermediates/GRDB.build/Debug-iphonesimulator/GRDBiOSTests.build/Objects-normal/x86_64/DatabaseValueConvertibleEncodableTests.dia -Onone -module-name GRDBiOSTests -emit-module-path /Users/groue/Library/Developer/Xcode/DerivedData/GRDB-ewuprfwphsnwtmeyrxipxvnnkjxx/Build/Intermediates/CodeCoverage/Intermediates/GRDB.build/Debug-iphonesimulator/GRDBiOSTests.build/Objects-normal/x86_64/DatabaseValueConvertibleEncodableTests~partial.swiftmodule -emit-dependencies-path /Users/groue/Library/Developer/Xcode/DerivedData/GRDB-ewuprfwphsnwtmeyrxipxvnnkjxx/Build/Intermediates/CodeCoverage/Intermediates/GRDB.build/Debug-iphonesimulator/GRDBiOSTests.build/Objects-normal/x86_64/DatabaseValueConvertibleEncodableTests.d -emit-reference-dependencies-path /Users/groue/Library/Developer/Xcode/DerivedData/GRDB-ewuprfwphsnwtmeyrxipxvnnkjxx/Build/Intermediates/CodeCoverage/Intermediates/GRDB.build/Debug-iphonesimulator/GRDBiOSTests.build/Objects-normal/x86_64/DatabaseValueConvertibleEncodableTests.swiftdeps -o /Users/groue/Library/Developer/Xcode/DerivedData/GRDB-ewuprfwphsnwtmeyrxipxvnnkjxx/Build/Intermediates/CodeCoverage/Intermediates/GRDB.build/Debug-iphonesimulator/GRDBiOSTests.build/Objects-normal/x86_64/DatabaseValueConvertibleEncodableTests.o
        // 1.	While walking into decl 'DatabaseValueConvertibleEncodableTests' at /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseValueConvertibleEncodableTests.swift:10:1
        // 2.	While walking into body of 'testEncodableRawRepresentable' at /Users/groue/Documents/git/groue/GRDB.swift/Tests/GRDBTests/DatabaseValueConvertibleEncodableTests.swift:33:5
        
        // DatabaseValueConvertible favors RawValue over Encodable
        struct Value : RawRepresentable, Encodable, DatabaseValueConvertible {
            let rawValue: Date
        }
    
        let dbValue = Value(rawValue: Date()).databaseValue
        XCTAssertEqual(dbValue.storage.value is String)
    }
    
    func testEncodableRawRepresentableEnum() {
        // Make sure this kind of declaration is possible
        enum Value : String, Encodable, DatabaseValueConvertible {
            case foo, bar
        }
        let dbValue = Value.foo.databaseValue
        XCTAssertEqual(dbValue.storage.value as! String, "foo")
    }
}
